<!-- app/views/users/search.html.erb -->

<h1>Find Friends</h1>

<%= form_with url: search_users_path, method: :get, local: true do %>
  <div class="form-group">
    <%= label_tag :email, "Search by email:" %>
    <%= text_field_tag :email, params[:email], placeholder: "Enter email", class: "form-control" %>
    <%= submit_tag "Search", class: "btn btn-primary mt-2" %>
  </div>
<% end %>
<% if @users.present? %>
  <h2>Search Results:</h2>
  <ul>
    <% @users.each do |user| %>
      <li>
        <%= link_to user.email, user_path(user) %>
        <% if current_user.friend_request_exists?(user) %>
          <p>Friend request already sent.</p>
        <% elsif !current_user.friend?(user) %>
          <%= button_to "Add Friend", user_friendships_path(current_user), method: :post, params: { friend_id: user.id }, class: "btn btn-secondary" %>
        <% else %>
          <p>Already friends.</p>
        <% end %>
      </li>
    <% end %>
  </ul>
<% elsif params[:email].present? %>
  <p>No users found with that email.</p>
<% end %>
