<h1>Conversation with <%= @conversation.other_user(current_user).email %></h1>

<div id="conversation-header" data-conversation-id="<%= @conversation.id %>">
  <h2>Details about the conversation</h2>
  <p>Participants: <%= @conversation.messages.map(&:sender).map(&:email).uniq.join(', ') %></p>
</div>

<div id="messages">
  <% @messages.each do |message| %>
    <div class="message">
      <% if message.sender == current_user %>
        <strong>You:</strong>
      <% else %>
        <strong><%= message.sender.email %>:</strong>
      <% end %>
      <p><%= message.content %></p>
      <p><small><%= time_ago_in_words(message.created_at) %> ago</small></p>
    </div>
  <% end %>
</div>

<% if @conversation %>
  <%= form_with(model: Message.new, url: user_conversation_messages_path(user_id: current_user.id, conversation_id: @conversation.id)) do |form| %>
    <%= form.text_area :content %>
    <%= form.submit "Send" %>
  <% end %>
<% else %>
  <p>Error: Conversation not found.</p>
<% end %>
