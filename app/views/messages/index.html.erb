<h1>Conversation with <%= @conversation.other_user(current_user).email %></h1>

<%= form_with model: @message, url: user_conversation_messages_path(user_id: current_user.id, conversation_id: @conversation.id), local: true do |form| %>
  <div class="form-group">
    <%= form.text_area :content, class: 'form-control', rows: 3, placeholder: "Type your message..." %>
  </div>
  <%= form.submit 'Send', class: 'btn btn-primary' %>
<% end %>

<% if @messages.present? %>
  <% @messages.each do |message| %>
    <% other_user = message.sender_id == current_user.id ? User.find(message.receiver_id) : User.find(message.sender_id) %>
    <div class="message">
      <p><strong><%= other_user.email %>:</strong> <%= message.content %></p>
      <p><small><%= time_ago_in_words(message.created_at) %> ago</small></p>
    </div>
  <% end %>
<% end %>
